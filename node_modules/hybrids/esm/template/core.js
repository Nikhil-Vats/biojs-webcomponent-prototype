function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

import { stringifyElement, shadyCSS, IS_IE } from '../utils';
import { dataMap, removeTemplate } from './utils';
import resolveValue from './resolvers/value';
import resolveProperty from './resolvers/property';
var TIMESTAMP = Date.now();

var getPlaceholder = function getPlaceholder() {
  var id = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
  return "{{h-".concat(TIMESTAMP, "-").concat(id, "}}");
};

var PLACEHOLDER_REGEXP_TEXT = getPlaceholder('(\\d+)');
var PLACEHOLDER_REGEXP_EQUAL = new RegExp("^".concat(PLACEHOLDER_REGEXP_TEXT, "$"));
var PLACEHOLDER_REGEXP_ALL = new RegExp(PLACEHOLDER_REGEXP_TEXT, 'g');
var ATTR_PREFIX = "--".concat(TIMESTAMP, "--");
var ATTR_REGEXP = new RegExp(ATTR_PREFIX, 'g');
var preparedTemplates = new WeakMap();
/* istanbul ignore next */

function applyShadyCSS(template, tagName) {
  if (!tagName) return template;
  return shadyCSS(function (shady) {
    var map = preparedTemplates.get(template);

    if (!map) {
      map = new Map();
      preparedTemplates.set(template, map);
    }

    var clone = map.get(tagName);

    if (!clone) {
      clone = document.createElement('template');
      clone.content.appendChild(template.content.cloneNode(true));
      map.set(tagName, clone);
      var styles = clone.content.querySelectorAll('style');
      Array.from(styles).forEach(function (style) {
        var count = style.childNodes.length + 1;

        for (var i = 0; i < count; i += 1) {
          style.parentNode.insertBefore(document.createTextNode(getPlaceholder()), style);
        }
      });
      shady.prepareTemplate(clone, tagName.toLowerCase());
    }

    return clone;
  }, template);
}

export function createId(parts, isSVG) {
  return "".concat(isSVG ? 'svg:' : '').concat(parts.join(getPlaceholder()));
}

function createSignature(parts) {
  var signature = parts.reduce(function (acc, part, index) {
    if (index === 0) {
      return part;
    }

    if (parts.slice(index).join('').match(/\s*<\/\s*(table|tr|thead|tbody|tfoot|colgroup)>/)) {
      return "".concat(acc, "<!--").concat(getPlaceholder(index - 1), "-->").concat(part);
    }

    return acc + getPlaceholder(index - 1) + part;
  }, '');
  /* istanbul ignore if */

  if (IS_IE) {
    return signature.replace(/style\s*=\s*(["][^"]+["]|['][^']+[']|[^\s"'<>/]+)/g, function (match) {
      return "".concat(ATTR_PREFIX).concat(match);
    });
  }

  return signature;
}

function getPropertyName(string) {
  return string.replace(/\s*=\s*['"]*$/g, '').split(' ').pop();
}

function replaceComments(fragment) {
  var iterator = document.createNodeIterator(fragment, NodeFilter.SHOW_COMMENT, null, false);
  var node; // eslint-disable-next-line no-cond-assign

  while (node = iterator.nextNode()) {
    if (PLACEHOLDER_REGEXP_EQUAL.test(node.textContent)) {
      node.parentNode.insertBefore(document.createTextNode(node.textContent), node);
      node.parentNode.removeChild(node);
    }
  }
}

export function createInternalWalker(context) {
  var node;
  return {
    get currentNode() {
      return node;
    },

    nextNode: function nextNode() {
      if (node === undefined) {
        node = context.childNodes[0];
      } else if (node.childNodes.length) {
        node = node.childNodes[0];
      } else if (node.nextSibling) {
        node = node.nextSibling;
      } else {
        node = node.parentNode.nextSibling;
      }

      return !!node;
    }
  };
}

function createExternalWalker(context) {
  return document.createTreeWalker(context, // eslint-disable-next-line no-bitwise
  NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, null, false);
}
/* istanbul ignore next */


var createWalker = _typeof(window.ShadyDOM) === 'object' && window.ShadyDOM.inUse ? createInternalWalker : createExternalWalker;
var container = document.createElement('div');
export function compile(rawParts, isSVG) {
  var template = document.createElement('template');
  var parts = [];
  var signature = createSignature(rawParts);
  if (isSVG) signature = "<svg>".concat(signature, "</svg>");
  /* istanbul ignore if */

  if (IS_IE) {
    template.innerHTML = signature;
  } else {
    container.innerHTML = "<template>".concat(signature, "</template>");
    template.content.appendChild(container.children[0].content);
  }

  if (isSVG) {
    var svgRoot = template.content.firstChild;
    template.content.removeChild(svgRoot);
    Array.from(svgRoot.childNodes).forEach(function (node) {
      return template.content.appendChild(node);
    });
  }

  replaceComments(template.content);
  var compileWalker = createWalker(template.content);
  var compileIndex = 0;

  var _loop = function _loop() {
    var node = compileWalker.currentNode;

    if (node.nodeType === Node.TEXT_NODE) {
      var text = node.textContent;

      if (!text.match(PLACEHOLDER_REGEXP_EQUAL)) {
        var results = text.match(PLACEHOLDER_REGEXP_ALL);

        if (results) {
          var currentNode = node;
          results.reduce(function (acc, placeholder) {
            var _acc$pop$split = acc.pop().split(placeholder),
                _acc$pop$split2 = _slicedToArray(_acc$pop$split, 2),
                before = _acc$pop$split2[0],
                next = _acc$pop$split2[1];

            if (before) acc.push(before);
            acc.push(placeholder);
            if (next) acc.push(next);
            return acc;
          }, [text]).forEach(function (part, index) {
            if (index === 0) {
              currentNode.textContent = part;
            } else {
              currentNode = currentNode.parentNode.insertBefore(document.createTextNode(part), currentNode.nextSibling);
            }
          });
        }
      }

      var equal = node.textContent.match(PLACEHOLDER_REGEXP_EQUAL);

      if (equal) {
        /* istanbul ignore else */
        if (!IS_IE) node.textContent = '';
        parts[equal[1]] = [compileIndex, resolveValue];
      }
    } else {
      /* istanbul ignore else */
      // eslint-disable-next-line no-lonely-if
      if (node.nodeType === Node.ELEMENT_NODE) {
        Array.from(node.attributes).forEach(function (attr) {
          var value = attr.value.trim();
          /* istanbul ignore next */

          var name = IS_IE ? attr.name.replace(ATTR_PREFIX, '') : attr.name;
          var equal = value.match(PLACEHOLDER_REGEXP_EQUAL);

          if (equal) {
            var propertyName = getPropertyName(rawParts[equal[1]]);
            parts[equal[1]] = [compileIndex, resolveProperty(name, propertyName, isSVG)];
            node.removeAttribute(attr.name);
          } else {
            var _results = value.match(PLACEHOLDER_REGEXP_ALL);

            if (_results) {
              var partialName = "attr__".concat(name);

              _results.forEach(function (placeholder, index) {
                var _placeholder$match = placeholder.match(PLACEHOLDER_REGEXP_EQUAL),
                    _placeholder$match2 = _slicedToArray(_placeholder$match, 2),
                    id = _placeholder$match2[1];

                parts[id] = [compileIndex, function (host, target, attrValue) {
                  var data = dataMap.get(target, {});
                  data[partialName] = (data[partialName] || value).replace(placeholder, attrValue == null ? '' : attrValue);

                  if (_results.length === 1 || index + 1 === _results.length) {
                    target.setAttribute(name, data[partialName]);
                    data[partialName] = undefined;
                  }
                }];
              });

              attr.value = '';
              /* istanbul ignore next */

              if (IS_IE && name !== attr.name) {
                node.removeAttribute(attr.name);
                node.setAttribute(name, '');
              }
            }
          }
        });
      }
    }

    compileIndex += 1;
  };

  while (compileWalker.nextNode()) {
    _loop();
  }

  return function (host, target, args) {
    var data = dataMap.get(target, {
      type: 'function'
    });

    if (template !== data.template) {
      if (data.template) removeTemplate(target);
      var fragment = document.importNode(applyShadyCSS(template, host.tagName).content, true);
      var renderWalker = createWalker(fragment);
      var clonedParts = parts.slice(0);
      var renderIndex = 0;
      var currentPart = clonedParts.shift();
      var markers = [];
      Object.assign(data, {
        template: template,
        markers: markers
      });

      while (renderWalker.nextNode()) {
        var node = renderWalker.currentNode;

        if (node.nodeType === Node.TEXT_NODE) {
          /* istanbul ignore next */
          if (PLACEHOLDER_REGEXP_EQUAL.test(node.textContent)) {
            node.textContent = '';
          } else if (IS_IE) {
            node.textContent = node.textContent.replace(ATTR_REGEXP, '');
          }
        } else if (process.env.NODE_ENV !== 'production' && node.nodeType === Node.ELEMENT_NODE) {
          if (node.tagName.indexOf('-') > -1 && !customElements.get(node.tagName.toLowerCase())) {
            throw Error("Missing '".concat(stringifyElement(node), "' element definition in '").concat(stringifyElement(host), "'"));
          }
        }

        while (currentPart && currentPart[0] === renderIndex) {
          markers.push([node, currentPart[1]]);
          currentPart = clonedParts.shift();
        }

        renderIndex += 1;
      }

      var childList = Array.from(fragment.childNodes);
      data.startNode = childList[0];
      data.endNode = childList[childList.length - 1];

      if (target.nodeType === Node.TEXT_NODE) {
        var previousChild = target;
        childList.forEach(function (child) {
          target.parentNode.insertBefore(child, previousChild.nextSibling);
          previousChild = child;
        });
      } else {
        target.appendChild(fragment);
      }
    }

    data.markers.forEach(function (_ref, index) {
      var _ref2 = _slicedToArray(_ref, 2),
          node = _ref2[0],
          fn = _ref2[1];

      if (data.lastArgs && data.lastArgs[index] === args[index]) return;
      fn(host, node, args[index], data.lastArgs ? data.lastArgs[index] : undefined);
    });
    data.lastArgs = args;
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZW1wbGF0ZS9jb3JlLmpzIl0sIm5hbWVzIjpbInN0cmluZ2lmeUVsZW1lbnQiLCJzaGFkeUNTUyIsIklTX0lFIiwiZGF0YU1hcCIsInJlbW92ZVRlbXBsYXRlIiwicmVzb2x2ZVZhbHVlIiwicmVzb2x2ZVByb3BlcnR5IiwiVElNRVNUQU1QIiwiRGF0ZSIsIm5vdyIsImdldFBsYWNlaG9sZGVyIiwiaWQiLCJQTEFDRUhPTERFUl9SRUdFWFBfVEVYVCIsIlBMQUNFSE9MREVSX1JFR0VYUF9FUVVBTCIsIlJlZ0V4cCIsIlBMQUNFSE9MREVSX1JFR0VYUF9BTEwiLCJBVFRSX1BSRUZJWCIsIkFUVFJfUkVHRVhQIiwicHJlcGFyZWRUZW1wbGF0ZXMiLCJXZWFrTWFwIiwiYXBwbHlTaGFkeUNTUyIsInRlbXBsYXRlIiwidGFnTmFtZSIsInNoYWR5IiwibWFwIiwiZ2V0IiwiTWFwIiwic2V0IiwiY2xvbmUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjb250ZW50IiwiYXBwZW5kQ2hpbGQiLCJjbG9uZU5vZGUiLCJzdHlsZXMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiQXJyYXkiLCJmcm9tIiwiZm9yRWFjaCIsInN0eWxlIiwiY291bnQiLCJjaGlsZE5vZGVzIiwibGVuZ3RoIiwiaSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiLCJjcmVhdGVUZXh0Tm9kZSIsInByZXBhcmVUZW1wbGF0ZSIsInRvTG93ZXJDYXNlIiwiY3JlYXRlSWQiLCJwYXJ0cyIsImlzU1ZHIiwiam9pbiIsImNyZWF0ZVNpZ25hdHVyZSIsInNpZ25hdHVyZSIsInJlZHVjZSIsImFjYyIsInBhcnQiLCJpbmRleCIsInNsaWNlIiwibWF0Y2giLCJyZXBsYWNlIiwiZ2V0UHJvcGVydHlOYW1lIiwic3RyaW5nIiwic3BsaXQiLCJwb3AiLCJyZXBsYWNlQ29tbWVudHMiLCJmcmFnbWVudCIsIml0ZXJhdG9yIiwiY3JlYXRlTm9kZUl0ZXJhdG9yIiwiTm9kZUZpbHRlciIsIlNIT1dfQ09NTUVOVCIsIm5vZGUiLCJuZXh0Tm9kZSIsInRlc3QiLCJ0ZXh0Q29udGVudCIsInJlbW92ZUNoaWxkIiwiY3JlYXRlSW50ZXJuYWxXYWxrZXIiLCJjb250ZXh0IiwiY3VycmVudE5vZGUiLCJ1bmRlZmluZWQiLCJuZXh0U2libGluZyIsImNyZWF0ZUV4dGVybmFsV2Fsa2VyIiwiY3JlYXRlVHJlZVdhbGtlciIsIlNIT1dfRUxFTUVOVCIsIlNIT1dfVEVYVCIsImNyZWF0ZVdhbGtlciIsIndpbmRvdyIsIlNoYWR5RE9NIiwiaW5Vc2UiLCJjb250YWluZXIiLCJjb21waWxlIiwicmF3UGFydHMiLCJpbm5lckhUTUwiLCJjaGlsZHJlbiIsInN2Z1Jvb3QiLCJmaXJzdENoaWxkIiwiY29tcGlsZVdhbGtlciIsImNvbXBpbGVJbmRleCIsIm5vZGVUeXBlIiwiTm9kZSIsIlRFWFRfTk9ERSIsInRleHQiLCJyZXN1bHRzIiwicGxhY2Vob2xkZXIiLCJiZWZvcmUiLCJuZXh0IiwicHVzaCIsImVxdWFsIiwiRUxFTUVOVF9OT0RFIiwiYXR0cmlidXRlcyIsImF0dHIiLCJ2YWx1ZSIsInRyaW0iLCJuYW1lIiwicHJvcGVydHlOYW1lIiwicmVtb3ZlQXR0cmlidXRlIiwicGFydGlhbE5hbWUiLCJob3N0IiwidGFyZ2V0IiwiYXR0clZhbHVlIiwiZGF0YSIsInNldEF0dHJpYnV0ZSIsImFyZ3MiLCJ0eXBlIiwiaW1wb3J0Tm9kZSIsInJlbmRlcldhbGtlciIsImNsb25lZFBhcnRzIiwicmVuZGVySW5kZXgiLCJjdXJyZW50UGFydCIsInNoaWZ0IiwibWFya2VycyIsIk9iamVjdCIsImFzc2lnbiIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsImluZGV4T2YiLCJjdXN0b21FbGVtZW50cyIsIkVycm9yIiwiY2hpbGRMaXN0Iiwic3RhcnROb2RlIiwiZW5kTm9kZSIsInByZXZpb3VzQ2hpbGQiLCJjaGlsZCIsImZuIiwibGFzdEFyZ3MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxTQUFTQSxn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QUFFQSxVQUFJNkUsTUFBTSxDQUFDcEIsUUFBUCxLQUFvQkMsSUFBSSxDQUFDQyxTQUE3QixFQUF3QztBQUN0QyxZQUFJMEMsYUFBYSxHQUFHeEIsTUFBcEI7QUFDQXFCLFFBQUFBLFNBQVMsQ0FBQ3RHLE9BQVYsQ0FBa0IsVUFBQzBHLEtBQUQsRUFBVztBQUMzQnpCLFVBQUFBLE1BQU0sQ0FBQzNFLFVBQVAsQ0FBa0JDLFlBQWxCLENBQStCbUcsS0FBL0IsRUFBc0NELGFBQWEsQ0FBQzlELFdBQXBEO0FBQ0E4RCxVQUFBQSxhQUFhLEdBQUdDLEtBQWhCO0FBQ0QsU0FIRDtBQUlELE9BTkQsTUFNTztBQUNMekIsUUFBQUEsTUFBTSxDQUFDdkYsV0FBUCxDQUFtQm1DLFFBQW5CO0FBQ0Q7QUFDRjs7QUFFRHNELElBQUFBLElBQUksQ0FBQ1UsT0FBTCxDQUFhN0YsT0FBYixDQUFxQixnQkFBYW9CLEtBQWIsRUFBdUI7QUFBQTtBQUFBLFVBQXJCYyxJQUFxQjtBQUFBLFVBQWZ5RSxFQUFlOztBQUMxQyxVQUFJeEIsSUFBSSxDQUFDeUIsUUFBTCxJQUFpQnpCLElBQUksQ0FBQ3lCLFFBQUwsQ0FBY3hGLEtBQWQsTUFBeUJpRSxJQUFJLENBQUNqRSxLQUFELENBQWxELEVBQTJEO0FBQzNEdUYsTUFBQUEsRUFBRSxDQUFDM0IsSUFBRCxFQUFPOUMsSUFBUCxFQUFhbUQsSUFBSSxDQUFDakUsS0FBRCxDQUFqQixFQUEwQitELElBQUksQ0FBQ3lCLFFBQUwsR0FBZ0J6QixJQUFJLENBQUN5QixRQUFMLENBQWN4RixLQUFkLENBQWhCLEdBQXVDc0IsU0FBakUsQ0FBRjtBQUNELEtBSEQ7QUFLQXlDLElBQUFBLElBQUksQ0FBQ3lCLFFBQUwsR0FBZ0J2QixJQUFoQjtBQUNELEdBaEVEO0FBaUVEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc3RyaW5naWZ5RWxlbWVudCwgc2hhZHlDU1MsIElTX0lFIH0gZnJvbSAnLi4vdXRpbHMnO1xuaW1wb3J0IHsgZGF0YU1hcCwgcmVtb3ZlVGVtcGxhdGUgfSBmcm9tICcuL3V0aWxzJztcblxuaW1wb3J0IHJlc29sdmVWYWx1ZSBmcm9tICcuL3Jlc29sdmVycy92YWx1ZSc7XG5pbXBvcnQgcmVzb2x2ZVByb3BlcnR5IGZyb20gJy4vcmVzb2x2ZXJzL3Byb3BlcnR5JztcblxuY29uc3QgVElNRVNUQU1QID0gRGF0ZS5ub3coKTtcblxuY29uc3QgZ2V0UGxhY2Vob2xkZXIgPSAoaWQgPSAwKSA9PiBge3toLSR7VElNRVNUQU1QfS0ke2lkfX19YDtcblxuY29uc3QgUExBQ0VIT0xERVJfUkVHRVhQX1RFWFQgPSBnZXRQbGFjZWhvbGRlcignKFxcXFxkKyknKTtcbmNvbnN0IFBMQUNFSE9MREVSX1JFR0VYUF9FUVVBTCA9IG5ldyBSZWdFeHAoYF4ke1BMQUNFSE9MREVSX1JFR0VYUF9URVhUfSRgKTtcbmNvbnN0IFBMQUNFSE9MREVSX1JFR0VYUF9BTEwgPSBuZXcgUmVnRXhwKFBMQUNFSE9MREVSX1JFR0VYUF9URVhULCAnZycpO1xuXG5jb25zdCBBVFRSX1BSRUZJWCA9IGAtLSR7VElNRVNUQU1QfS0tYDtcbmNvbnN0IEFUVFJfUkVHRVhQID0gbmV3IFJlZ0V4cChBVFRSX1BSRUZJWCwgJ2cnKTtcblxuY29uc3QgcHJlcGFyZWRUZW1wbGF0ZXMgPSBuZXcgV2Vha01hcCgpO1xuXG4vKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuZnVuY3Rpb24gYXBwbHlTaGFkeUNTUyh0ZW1wbGF0ZSwgdGFnTmFtZSkge1xuICBpZiAoIXRhZ05hbWUpIHJldHVybiB0ZW1wbGF0ZTtcblxuICByZXR1cm4gc2hhZHlDU1MoKHNoYWR5KSA9PiB7XG4gICAgbGV0IG1hcCA9IHByZXBhcmVkVGVtcGxhdGVzLmdldCh0ZW1wbGF0ZSk7XG4gICAgaWYgKCFtYXApIHtcbiAgICAgIG1hcCA9IG5ldyBNYXAoKTtcbiAgICAgIHByZXBhcmVkVGVtcGxhdGVzLnNldCh0ZW1wbGF0ZSwgbWFwKTtcbiAgICB9XG5cbiAgICBsZXQgY2xvbmUgPSBtYXAuZ2V0KHRhZ05hbWUpO1xuXG4gICAgaWYgKCFjbG9uZSkge1xuICAgICAgY2xvbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZW1wbGF0ZScpO1xuICAgICAgY2xvbmUuY29udGVudC5hcHBlbmRDaGlsZCh0ZW1wbGF0ZS5jb250ZW50LmNsb25lTm9kZSh0cnVlKSk7XG5cbiAgICAgIG1hcC5zZXQodGFnTmFtZSwgY2xvbmUpO1xuXG4gICAgICBjb25zdCBzdHlsZXMgPSBjbG9uZS5jb250ZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3N0eWxlJyk7XG5cbiAgICAgIEFycmF5LmZyb20oc3R5bGVzKS5mb3JFYWNoKChzdHlsZSkgPT4ge1xuICAgICAgICBjb25zdCBjb3VudCA9IHN0eWxlLmNoaWxkTm9kZXMubGVuZ3RoICsgMTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSArPSAxKSB7XG4gICAgICAgICAgc3R5bGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZ2V0UGxhY2Vob2xkZXIoKSksIHN0eWxlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHNoYWR5LnByZXBhcmVUZW1wbGF0ZShjbG9uZSwgdGFnTmFtZS50b0xvd2VyQ2FzZSgpKTtcbiAgICB9XG4gICAgcmV0dXJuIGNsb25lO1xuICB9LCB0ZW1wbGF0ZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVJZChwYXJ0cywgaXNTVkcpIHtcbiAgcmV0dXJuIGAke2lzU1ZHID8gJ3N2ZzonIDogJyd9JHtwYXJ0cy5qb2luKGdldFBsYWNlaG9sZGVyKCkpfWA7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNpZ25hdHVyZShwYXJ0cykge1xuICBjb25zdCBzaWduYXR1cmUgPSBwYXJ0cy5yZWR1Y2UoKGFjYywgcGFydCwgaW5kZXgpID0+IHtcbiAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgIHJldHVybiBwYXJ0O1xuICAgIH1cbiAgICBpZiAocGFydHMuc2xpY2UoaW5kZXgpLmpvaW4oJycpLm1hdGNoKC9cXHMqPFxcL1xccyoodGFibGV8dHJ8dGhlYWR8dGJvZHl8dGZvb3R8Y29sZ3JvdXApPi8pKSB7XG4gICAgICByZXR1cm4gYCR7YWNjfTwhLS0ke2dldFBsYWNlaG9sZGVyKGluZGV4IC0gMSl9LS0+JHtwYXJ0fWA7XG4gICAgfVxuICAgIHJldHVybiBhY2MgKyBnZXRQbGFjZWhvbGRlcihpbmRleCAtIDEpICsgcGFydDtcbiAgfSwgJycpO1xuXG4gIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqL1xuICBpZiAoSVNfSUUpIHtcbiAgICByZXR1cm4gc2lnbmF0dXJlLnJlcGxhY2UoXG4gICAgICAvc3R5bGVcXHMqPVxccyooW1wiXVteXCJdK1tcIl18WyddW14nXStbJ118W15cXHNcIic8Pi9dKykvZyxcbiAgICAgIG1hdGNoID0+IGAke0FUVFJfUFJFRklYfSR7bWF0Y2h9YCxcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIHNpZ25hdHVyZTtcbn1cblxuZnVuY3Rpb24gZ2V0UHJvcGVydHlOYW1lKHN0cmluZykge1xuICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoL1xccyo9XFxzKlsnXCJdKiQvZywgJycpLnNwbGl0KCcgJykucG9wKCk7XG59XG5cbmZ1bmN0aW9uIHJlcGxhY2VDb21tZW50cyhmcmFnbWVudCkge1xuICBjb25zdCBpdGVyYXRvciA9IGRvY3VtZW50LmNyZWF0ZU5vZGVJdGVyYXRvcihmcmFnbWVudCwgTm9kZUZpbHRlci5TSE9XX0NPTU1FTlQsIG51bGwsIGZhbHNlKTtcbiAgbGV0IG5vZGU7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25kLWFzc2lnblxuICB3aGlsZSAobm9kZSA9IGl0ZXJhdG9yLm5leHROb2RlKCkpIHtcbiAgICBpZiAoUExBQ0VIT0xERVJfUkVHRVhQX0VRVUFMLnRlc3Qobm9kZS50ZXh0Q29udGVudCkpIHtcbiAgICAgIG5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobm9kZS50ZXh0Q29udGVudCksIG5vZGUpO1xuICAgICAgbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlSW50ZXJuYWxXYWxrZXIoY29udGV4dCkge1xuICBsZXQgbm9kZTtcblxuICByZXR1cm4ge1xuICAgIGdldCBjdXJyZW50Tm9kZSgpIHsgcmV0dXJuIG5vZGU7IH0sXG4gICAgbmV4dE5vZGUoKSB7XG4gICAgICBpZiAobm9kZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG5vZGUgPSBjb250ZXh0LmNoaWxkTm9kZXNbMF07XG4gICAgICB9IGVsc2UgaWYgKG5vZGUuY2hpbGROb2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgbm9kZSA9IG5vZGUuY2hpbGROb2Rlc1swXTtcbiAgICAgIH0gZWxzZSBpZiAobm9kZS5uZXh0U2libGluZykge1xuICAgICAgICBub2RlID0gbm9kZS5uZXh0U2libGluZztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGUubmV4dFNpYmxpbmc7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAhIW5vZGU7XG4gICAgfSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRXh0ZXJuYWxXYWxrZXIoY29udGV4dCkge1xuICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlVHJlZVdhbGtlcihcbiAgICBjb250ZXh0LFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlXG4gICAgTm9kZUZpbHRlci5TSE9XX0VMRU1FTlQgfCBOb2RlRmlsdGVyLlNIT1dfVEVYVCxcbiAgICBudWxsLFxuICAgIGZhbHNlLFxuICApO1xufVxuXG4vKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuY29uc3QgY3JlYXRlV2Fsa2VyID0gdHlwZW9mIHdpbmRvdy5TaGFkeURPTSA9PT0gJ29iamVjdCcgJiYgd2luZG93LlNoYWR5RE9NLmluVXNlID8gY3JlYXRlSW50ZXJuYWxXYWxrZXIgOiBjcmVhdGVFeHRlcm5hbFdhbGtlcjtcblxuY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5leHBvcnQgZnVuY3Rpb24gY29tcGlsZShyYXdQYXJ0cywgaXNTVkcpIHtcbiAgY29uc3QgdGVtcGxhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZW1wbGF0ZScpO1xuICBjb25zdCBwYXJ0cyA9IFtdO1xuXG4gIGxldCBzaWduYXR1cmUgPSBjcmVhdGVTaWduYXR1cmUocmF3UGFydHMpO1xuICBpZiAoaXNTVkcpIHNpZ25hdHVyZSA9IGA8c3ZnPiR7c2lnbmF0dXJlfTwvc3ZnPmA7XG5cbiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovXG4gIGlmIChJU19JRSkge1xuICAgIHRlbXBsYXRlLmlubmVySFRNTCA9IHNpZ25hdHVyZTtcbiAgfSBlbHNlIHtcbiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gYDx0ZW1wbGF0ZT4ke3NpZ25hdHVyZX08L3RlbXBsYXRlPmA7XG4gICAgdGVtcGxhdGUuY29udGVudC5hcHBlbmRDaGlsZChjb250YWluZXIuY2hpbGRyZW5bMF0uY29udGVudCk7XG4gIH1cblxuICBpZiAoaXNTVkcpIHtcbiAgICBjb25zdCBzdmdSb290ID0gdGVtcGxhdGUuY29udGVudC5maXJzdENoaWxkO1xuICAgIHRlbXBsYXRlLmNvbnRlbnQucmVtb3ZlQ2hpbGQoc3ZnUm9vdCk7XG4gICAgQXJyYXkuZnJvbShzdmdSb290LmNoaWxkTm9kZXMpLmZvckVhY2gobm9kZSA9PiB0ZW1wbGF0ZS5jb250ZW50LmFwcGVuZENoaWxkKG5vZGUpKTtcbiAgfVxuXG4gIHJlcGxhY2VDb21tZW50cyh0ZW1wbGF0ZS5jb250ZW50KTtcblxuICBjb25zdCBjb21waWxlV2Fsa2VyID0gY3JlYXRlV2Fsa2VyKHRlbXBsYXRlLmNvbnRlbnQpO1xuICBsZXQgY29tcGlsZUluZGV4ID0gMDtcblxuICB3aGlsZSAoY29tcGlsZVdhbGtlci5uZXh0Tm9kZSgpKSB7XG4gICAgY29uc3Qgbm9kZSA9IGNvbXBpbGVXYWxrZXIuY3VycmVudE5vZGU7XG5cbiAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUpIHtcbiAgICAgIGNvbnN0IHRleHQgPSBub2RlLnRleHRDb250ZW50O1xuXG4gICAgICBpZiAoIXRleHQubWF0Y2goUExBQ0VIT0xERVJfUkVHRVhQX0VRVUFMKSkge1xuICAgICAgICBjb25zdCByZXN1bHRzID0gdGV4dC5tYXRjaChQTEFDRUhPTERFUl9SRUdFWFBfQUxMKTtcbiAgICAgICAgaWYgKHJlc3VsdHMpIHtcbiAgICAgICAgICBsZXQgY3VycmVudE5vZGUgPSBub2RlO1xuICAgICAgICAgIHJlc3VsdHNcbiAgICAgICAgICAgIC5yZWR1Y2UoKGFjYywgcGxhY2Vob2xkZXIpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgW2JlZm9yZSwgbmV4dF0gPSBhY2MucG9wKCkuc3BsaXQocGxhY2Vob2xkZXIpO1xuICAgICAgICAgICAgICBpZiAoYmVmb3JlKSBhY2MucHVzaChiZWZvcmUpO1xuICAgICAgICAgICAgICBhY2MucHVzaChwbGFjZWhvbGRlcik7XG4gICAgICAgICAgICAgIGlmIChuZXh0KSBhY2MucHVzaChuZXh0KTtcbiAgICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICAgIH0sIFt0ZXh0XSlcbiAgICAgICAgICAgIC5mb3JFYWNoKChwYXJ0LCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS50ZXh0Q29udGVudCA9IHBhcnQ7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBjdXJyZW50Tm9kZS5wYXJlbnROb2RlXG4gICAgICAgICAgICAgICAgICAuaW5zZXJ0QmVmb3JlKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHBhcnQpLCBjdXJyZW50Tm9kZS5uZXh0U2libGluZyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVxdWFsID0gbm9kZS50ZXh0Q29udGVudC5tYXRjaChQTEFDRUhPTERFUl9SRUdFWFBfRVFVQUwpO1xuICAgICAgaWYgKGVxdWFsKSB7XG4gICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovXG4gICAgICAgIGlmICghSVNfSUUpIG5vZGUudGV4dENvbnRlbnQgPSAnJztcbiAgICAgICAgcGFydHNbZXF1YWxbMV1dID0gW2NvbXBpbGVJbmRleCwgcmVzb2x2ZVZhbHVlXTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWxvbmVseS1pZlxuICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFKSB7XG4gICAgICAgIEFycmF5LmZyb20obm9kZS5hdHRyaWJ1dGVzKS5mb3JFYWNoKChhdHRyKSA9PiB7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBhdHRyLnZhbHVlLnRyaW0oKTtcbiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICAgICAgICAgIGNvbnN0IG5hbWUgPSBJU19JRSA/IGF0dHIubmFtZS5yZXBsYWNlKEFUVFJfUFJFRklYLCAnJykgOiBhdHRyLm5hbWU7XG4gICAgICAgICAgY29uc3QgZXF1YWwgPSB2YWx1ZS5tYXRjaChQTEFDRUhPTERFUl9SRUdFWFBfRVFVQUwpO1xuICAgICAgICAgIGlmIChlcXVhbCkge1xuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlOYW1lID0gZ2V0UHJvcGVydHlOYW1lKHJhd1BhcnRzW2VxdWFsWzFdXSk7XG4gICAgICAgICAgICBwYXJ0c1tlcXVhbFsxXV0gPSBbY29tcGlsZUluZGV4LCByZXNvbHZlUHJvcGVydHkobmFtZSwgcHJvcGVydHlOYW1lLCBpc1NWRyldO1xuICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoYXR0ci5uYW1lKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHZhbHVlLm1hdGNoKFBMQUNFSE9MREVSX1JFR0VYUF9BTEwpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgY29uc3QgcGFydGlhbE5hbWUgPSBgYXR0cl9fJHtuYW1lfWA7XG5cbiAgICAgICAgICAgICAgcmVzdWx0cy5mb3JFYWNoKChwbGFjZWhvbGRlciwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBbLCBpZF0gPSBwbGFjZWhvbGRlci5tYXRjaChQTEFDRUhPTERFUl9SRUdFWFBfRVFVQUwpO1xuICAgICAgICAgICAgICAgIHBhcnRzW2lkXSA9IFtjb21waWxlSW5kZXgsIChob3N0LCB0YXJnZXQsIGF0dHJWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGRhdGFNYXAuZ2V0KHRhcmdldCwge30pO1xuICAgICAgICAgICAgICAgICAgZGF0YVtwYXJ0aWFsTmFtZV0gPSAoZGF0YVtwYXJ0aWFsTmFtZV0gfHwgdmFsdWUpLnJlcGxhY2UocGxhY2Vob2xkZXIsIGF0dHJWYWx1ZSA9PSBudWxsID8gJycgOiBhdHRyVmFsdWUpO1xuXG4gICAgICAgICAgICAgICAgICBpZiAoKHJlc3VsdHMubGVuZ3RoID09PSAxKSB8fCAoaW5kZXggKyAxID09PSByZXN1bHRzLmxlbmd0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnNldEF0dHJpYnV0ZShuYW1lLCBkYXRhW3BhcnRpYWxOYW1lXSk7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbcGFydGlhbE5hbWVdID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1dO1xuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICBhdHRyLnZhbHVlID0gJyc7XG5cbiAgICAgICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAgICAgICAgICAgaWYgKElTX0lFICYmIG5hbWUgIT09IGF0dHIubmFtZSkge1xuICAgICAgICAgICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKGF0dHIubmFtZSk7XG4gICAgICAgICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUobmFtZSwgJycpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb21waWxlSW5kZXggKz0gMTtcbiAgfVxuXG4gIHJldHVybiAoaG9zdCwgdGFyZ2V0LCBhcmdzKSA9PiB7XG4gICAgY29uc3QgZGF0YSA9IGRhdGFNYXAuZ2V0KHRhcmdldCwgeyB0eXBlOiAnZnVuY3Rpb24nIH0pO1xuXG4gICAgaWYgKHRlbXBsYXRlICE9PSBkYXRhLnRlbXBsYXRlKSB7XG4gICAgICBpZiAoZGF0YS50ZW1wbGF0ZSkgcmVtb3ZlVGVtcGxhdGUodGFyZ2V0KTtcblxuICAgICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5pbXBvcnROb2RlKGFwcGx5U2hhZHlDU1ModGVtcGxhdGUsIGhvc3QudGFnTmFtZSkuY29udGVudCwgdHJ1ZSk7XG5cbiAgICAgIGNvbnN0IHJlbmRlcldhbGtlciA9IGNyZWF0ZVdhbGtlcihmcmFnbWVudCk7XG4gICAgICBjb25zdCBjbG9uZWRQYXJ0cyA9IHBhcnRzLnNsaWNlKDApO1xuXG4gICAgICBsZXQgcmVuZGVySW5kZXggPSAwO1xuICAgICAgbGV0IGN1cnJlbnRQYXJ0ID0gY2xvbmVkUGFydHMuc2hpZnQoKTtcblxuICAgICAgY29uc3QgbWFya2VycyA9IFtdO1xuXG4gICAgICBPYmplY3QuYXNzaWduKGRhdGEsIHsgdGVtcGxhdGUsIG1hcmtlcnMgfSk7XG5cbiAgICAgIHdoaWxlIChyZW5kZXJXYWxrZXIubmV4dE5vZGUoKSkge1xuICAgICAgICBjb25zdCBub2RlID0gcmVuZGVyV2Fsa2VyLmN1cnJlbnROb2RlO1xuXG4gICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSkge1xuICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgICAgICAgaWYgKFBMQUNFSE9MREVSX1JFR0VYUF9FUVVBTC50ZXN0KG5vZGUudGV4dENvbnRlbnQpKSB7XG4gICAgICAgICAgICBub2RlLnRleHRDb250ZW50ID0gJyc7XG4gICAgICAgICAgfSBlbHNlIGlmIChJU19JRSkge1xuICAgICAgICAgICAgbm9kZS50ZXh0Q29udGVudCA9IG5vZGUudGV4dENvbnRlbnQucmVwbGFjZShBVFRSX1JFR0VYUCwgJycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIG5vZGUubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFKSB7XG4gICAgICAgICAgaWYgKG5vZGUudGFnTmFtZS5pbmRleE9mKCctJykgPiAtMSAmJiAhY3VzdG9tRWxlbWVudHMuZ2V0KG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYE1pc3NpbmcgJyR7c3RyaW5naWZ5RWxlbWVudChub2RlKX0nIGVsZW1lbnQgZGVmaW5pdGlvbiBpbiAnJHtzdHJpbmdpZnlFbGVtZW50KGhvc3QpfSdgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB3aGlsZSAoY3VycmVudFBhcnQgJiYgY3VycmVudFBhcnRbMF0gPT09IHJlbmRlckluZGV4KSB7XG4gICAgICAgICAgbWFya2Vycy5wdXNoKFtub2RlLCBjdXJyZW50UGFydFsxXV0pO1xuICAgICAgICAgIGN1cnJlbnRQYXJ0ID0gY2xvbmVkUGFydHMuc2hpZnQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlbmRlckluZGV4ICs9IDE7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNoaWxkTGlzdCA9IEFycmF5LmZyb20oZnJhZ21lbnQuY2hpbGROb2Rlcyk7XG5cbiAgICAgIGRhdGEuc3RhcnROb2RlID0gY2hpbGRMaXN0WzBdO1xuICAgICAgZGF0YS5lbmROb2RlID0gY2hpbGRMaXN0W2NoaWxkTGlzdC5sZW5ndGggLSAxXTtcblxuICAgICAgaWYgKHRhcmdldC5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUpIHtcbiAgICAgICAgbGV0IHByZXZpb3VzQ2hpbGQgPSB0YXJnZXQ7XG4gICAgICAgIGNoaWxkTGlzdC5mb3JFYWNoKChjaGlsZCkgPT4ge1xuICAgICAgICAgIHRhcmdldC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShjaGlsZCwgcHJldmlvdXNDaGlsZC5uZXh0U2libGluZyk7XG4gICAgICAgICAgcHJldmlvdXNDaGlsZCA9IGNoaWxkO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRhcmdldC5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZGF0YS5tYXJrZXJzLmZvckVhY2goKFtub2RlLCBmbl0sIGluZGV4KSA9PiB7XG4gICAgICBpZiAoZGF0YS5sYXN0QXJncyAmJiBkYXRhLmxhc3RBcmdzW2luZGV4XSA9PT0gYXJnc1tpbmRleF0pIHJldHVybjtcbiAgICAgIGZuKGhvc3QsIG5vZGUsIGFyZ3NbaW5kZXhdLCBkYXRhLmxhc3RBcmdzID8gZGF0YS5sYXN0QXJnc1tpbmRleF0gOiB1bmRlZmluZWQpO1xuICAgIH0pO1xuXG4gICAgZGF0YS5sYXN0QXJncyA9IGFyZ3M7XG4gIH07XG59XG4iXX0=